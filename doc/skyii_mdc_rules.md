# SkyEye 智能监控系统 MDC 规则文件

## 1. 命名规范

### 1.1 文件命名

- **HTML文件**：使用小写字母，单词间用下划线连接，例如：`device_detail.html`
- **CSS文件**：使用小写字母，单词间用连字符连接，例如：`main-style.css`
- **JavaScript文件**：使用小驼峰命名法，例如：`deviceManager.js`
- **图片文件**：使用小写字母，描述性命名，例如：`header_logo.png`

### 1.2 变量命名

- **JavaScript变量**：使用小驼峰命名法，例如：`deviceStatus`
- **CSS类名**：使用小写字母，单词间用连字符连接，例如：`.device-status`
- **CSS ID**：使用小驼峰命名法，例如：`#deviceStatusPanel`
- **常量**：使用大写字母，单词间用下划线连接，例如：`MAX_DEVICE_COUNT`

### 1.3 函数命名

- **普通函数**：使用动词开头的小驼峰命名法，例如：`getDeviceStatus()`
- **事件处理函数**：使用`handle`或`on`开头，例如：`handleDeviceSelect()`
- **异步函数**：可以使用`async`前缀，例如：`asyncLoadDeviceData()`


## 3. 模块划分规则

### 3.1 前端模块

| 模块名称 | 文件前缀 | 主要功能 | 负责人 |
|---------|---------|---------|-------|
| 认证模块 | auth_* | 用户登录、注销、密码重置 | TBD |
| 设备管理 | device_* | 设备列表、添加、详情 | TBD |
| 监控管理 | monitoring_* | 实时监控、云台控制 | TBD |
| 报警中心 | alert_* | 报警列表、处理、配置 | TBD |
| 数据分析 | analytics_* | 数据统计、报表生成 | TBD |
| 任务调度 | task_* | 任务创建、调度、监控 | TBD |
| 系统设置 | settings_* | 各类系统参数配置 | TBD |
| 用户管理 | user_* | 用户账号、权限管理 | TBD |
| 历史记录 | history_* | 历史数据查询、回放 | TBD |
| 公共组件 | common_* | 共用组件、工具函数 | TBD |

### 3.2 后端模块

| 模块名称 | 包/文件夹 | 主要功能 | 负责人 |
|---------|---------|---------|-------|
| 用户认证 | auth | 身份验证、会话管理 | TBD |
| 设备管理 | device | 设备CRUD、状态管理 | TBD |
| 视频流处理 | stream | 视频流接收、转发 | TBD |
| 报警服务 | alert | 报警规则、通知发送 | TBD |
| 数据分析 | analytics | 数据处理、报表生成 | TBD |
| 任务调度 | scheduler | 任务创建、执行、监控 | TBD |
| 系统配置 | config | 系统参数管理 | TBD |
| 存储服务 | storage | 数据存储、备份恢复 | TBD |
| 日志服务 | logging | 日志收集、查询 | TBD |
| AI分析 | ai | 视频分析、智能识别 | TBD |

## 4. API规范

### 4.1 RESTful API设计

- 使用标准HTTP方法：GET、POST、PUT、DELETE
- URL使用名词复数形式：`/api/devices`而不是`/api/device`
- 使用嵌套资源表示关系：`/api/devices/{id}/metrics`
- 分页参数统一使用：`page`和`limit`
- 排序参数统一使用：`sort_by`和`order`
- 过滤参数使用：`filter_[字段名]`格式

### 4.2 API响应格式

- 优先使用Result.java对象：skyii-server\src\main\java\com\skyeye\common\response\Result.java
```json
{
    "code": 200,
    "message": "操作成功",
    "data": {
        // 响应数据
    },
    "meta": {
        "total": 100,
        "page": 1,
        "limit": 10
    }
}
```

### 4.3 错误处理

```json
{
    "code": 400,
    "message": "请求参数错误",
    "errors": [
        {
            "field": "name",
            "message": "设备名称不能为空"
        }
    ]
}
```

### 4.4 API版本控制

- 在URL中包含版本号：`/api/v1/devices`
- 主版本号变化表示不兼容的API更改

## 5. 数据库设计规范

### 5.1 命名规范

- **表名**：使用小写复数形式，例如：`devices`
- **字段名**：使用小写下划线分隔，例如：`device_name`
- **主键**：统一使用`id`作为主键名
- **外键**：使用`[表名单数]_id`格式，例如：`device_id`
- **索引**：使用`idx_[表名]_[字段名]`格式

### 5.2 字段设计

- 所有表必须包含以下字段：
  - `id`: 主键
  - `created_at`: 创建时间
  - `updated_at`: 更新时间
  - `deleted_at`: 软删除标记（可为空）
- 使用软删除而非物理删除
- 敏感数据必须加密存储
- 避免使用`TEXT`类型，除非必要

### 5.3 关系设计

- 明确定义外键约束
- 合理使用索引提高查询效率
- 多对多关系使用中间表

## 6. 安全规范

### 6.1 认证与授权

- 使用JWT进行API认证
- 实现基于角色的访问控制(RBAC)
- 敏感操作需要二次验证
- 会话超时自动登出

### 6.2 数据安全

- 敏感数据传输必须使用HTTPS
- 密码使用bcrypt或类似算法加密存储
- 实现防SQL注入措施
- 实现XSS防护

### 6.3 日志与审计

- 记录所有用户操作日志
- 记录系统关键事件日志
- 敏感操作需记录详细信息
- 日志不得包含敏感信息

## 7. 测试规范

### 7.1 单元测试

- 核心功能必须有单元测试
- 测试覆盖率目标>80%
- 每个API端点至少有一个测试用例
- 使用模拟对象隔离外部依赖

### 7.2 集成测试

- 测试关键业务流程
- 测试模块间交互
- 测试数据库交互
- 测试外部系统集成

### 7.3 UI测试

- 测试关键用户流程
- 测试响应式布局
- 测试浏览器兼容性
- 测试可访问性

## 8. 部署规范

### 8.1 环境划分

- 开发环境(dev)
- 测试环境(test)
- 预发布环境(staging)
- 生产环境(prod)

### 8.2 CI/CD流程

- 代码提交触发自动构建
- 自动运行测试套件
- 测试通过后自动部署到开发环境
- 手动触发生产环境部署

### 8.3 监控与告警

- 实现系统健康监控
- 实现性能指标监控
- 设置关键指标告警阈值
- 实现日志异常监控

## 9. 文档规范

### 9.1 代码注释

- 类和方法必须有文档注释
- 复杂逻辑必须有行内注释
- 使用TODO标记待完成项
- API方法必须注明参数和返回值

### 9.2 项目文档

- README.md包含项目概述和快速开始指南
- CONTRIBUTING.md描述贡献流程
- API文档使用Swagger或类似工具自动生成
- 架构文档描述系统组件和交互

## 10. 版本控制规范

### 10.1 Git工作流

- 主分支：main/master
- 开发分支：develop
- 功能分支：feature/*
- 发布分支：release/*
- 修复分支：hotfix/*

### 10.2 提交信息规范

格式：`<type>(<scope>): <subject>`

类型(type)：
- feat: 新功能
- fix: 修复bug
- docs: 文档变更
- style: 代码格式调整
- refactor: 代码重构
- perf: 性能优化
- test: 测试相关
- chore: 构建过程或辅助工具变更

### 10.3 版本号规范

使用语义化版本控制：`主版本号.次版本号.修订号`
- 主版本号：不兼容的API变更
- 次版本号：向下兼容的功能性新增
- 修订号：向下兼容的问题修正 